import math
import h5py as py
import matplotlib.pyplot as plt

file_name = "t3d_chm_mt_spudcan_cy_geo"

mat_ids = [
    104,
    108,
    119,
    126,
    239]
    # 247,
    # 251,
    # 364,
    # 367,
    # 371,
    # 375,
    # 496,
    # 500,
    # 503,
    # 507,
    # 509,
    # 625,
    # 626,
    # 627,
    # 635,
    # 746,
    # 748,
    # 752,
    # 753,
    # 754,
    # 755,
    # 760,
    # 762,
    # 764,
    # 880,
    # 883,
    # 890,
    # 1007,
    # 1008,
    # 1012,
    # 1017,
    # 1137,
    # 1141,
    # 1142,
    # 1146,
    # 1261,
    # 1262,
    # 1266,
    # 1270,
    # 1388,
    # 1389,
    # 1393,
    # 1394,
    # 1395,
    # 1399,
    # 1407,
    # 1516,
    # 1517,
    # 1518,
    # 1521,
    # 1526,
    # 1527,
    # 1642,
    # 1643,
    # 1644,
    # 1645,
    # 1646,
    # 1649,
    # 1653,
    # 1782,
    # 1786,
    # 1910,
    # 1911,
    # 1913,
    # 1914,
    # 1919,
    # 2039,
    # 2041,
    # 2156,
    # 2167,
    # 2168,
    # 2279,
    # 2280,
    # 2283,
    # 2284,
    # 2285,
    # 2294,
    # 2295,
    # 2296,
    # 2411,
    # 2412,
    # 2413,
    # 2414,
    # 2423,
    # 2427,
    # 2538,
    # 2539,
    # 2540,
    # 2541,
    # 2542,
    # 2544,
    # 2545,
    # 2546,
    # 2547,
    # 2675,
    # 2805,
    # 2806,
    # 2809,
    # 2810,
    # 2935,
    # 2937,
    # 2939,
    # 3063,
    # 3064,
    # 3066,
    # 3192,
    # 3308,
    # 3309,
    # 3310,
    # 3312,
    # 3313,
    # 3315,
    # 3319,
    # 3320,
    # 3436,
    # 3437,
    # 3446,
    # 3447,
    # 3448,
    # 3562,
    # 3564,
    # 3571,
    # 3572,
    # 3579,
    # 3691,
    # 3700,
    # 3706,
    # 3707,
    # 3708,
    # 3820,
    # 3831,
    # 3967,
    # 4075,
    # 4076,
    # 4077,
    # 4078,
    # 4079,
    # 4208,
    # 4467,
    # 4476,
    # 4478,
    # 4586,
    # 4588,
    # 4589,
    # 4590,
    # 4591,
    # 4593,
    # 4595,
    # 4596,
    # 4598,
    # 4599,
    # 4601,
    # 4604,
    # 4719,
    # 4729,
    # 4852,
    # 4980,
    # 4981,
    # 4984,
    # 4988,
    # 5116,
    # 5220,
    # 5236,
    # 5239,
    # 5240,
    # 5241,
    # 5358,
    # 5359,
    # 5360,
    # 5367,
    # 5369,
    # 5371,
    # 5480,
    # 5481,
    # 5482,
    # 5483,
    # 5484,
    # 5485,
    # 5486,
    # 5490,
    # 5491,
    # 5496,
    # 5497,
    # 5498,
    # 5499,
    # 5500,
    # 5501,
    # 5610,
    # 5611,
    # 5612,
    # 5613,
    # 5614,
    # 5616,
    # 5627,
    # 5882,
    # 5994,
    # 5995,
    # 5996,
    # 5997,
    # 5998,
    # 6002,
    # 6010,
    # 6015,
    # 6122,
    # 6126,
    # 6250,
    # 6517,
    # 6519,
    # 6641,
    # 6642,
    # 6763,
    # 6764,
    # 6765,
    # 6766,
    # 6767,
    # 6768,
    # 6769,
    # 6773,
    # 6776,
    # 6780,
    # 6781,
    # 6782,
    # 6892,
    # 6893,
    # 6894,
    # 6895,
    # 6896,
    # 6897,
    # 6899,
    # 6903,
    # 6904,
    # 6906,
    # 7017,
    # 7018,
    # 7019,
    # 7027,
    # 7032,
    # 7033,
    # 7161,
    # 7162,
    # 7163,
    # 7164,
    # 7165,
    # 7166,
    # 7277,
    # 7417,
    # 7418,
    # 7660,
    # 7802,
    # 7913,
    # 7914,
    # 7915,
    # 7926,
    # 7930,
    # 7931,
    # 8061,
    # 8063,
    # 8305,
    # 8308,
    # 8309,
    # 8427,
    # 8433,
    # 8434,
    # 8435,
    # 8436,
    # 8437,
    # 8438,
    # 8570,
    # 8572,
    # 9068,
    # 9069,
    # 9077,
    # 9084,
    # 9085,
    # 9341,
    # 9468,
    # 9581,
    # 9597,
    # 9709,
    # 9717,
    # 9725,
    # 9726,
    # 9843,
    # 9850,
    # 9853,
    # 9977,
    # 10092,
    # 10105,
    # 10109,
    # 10110,
    # 10220,
    # 10221,
    # 10238,
    # 10347,
    # 10352,
    # 10353,
    # 10354,
    # 10359,
    # 10363,
    # 10491,
    # 10492,
    # 10619,
    # 10747,
    # 10875,
    # 10995,
    # 10996,
    # 11116,
    # 11121,
    # 11123,
    # 11124,
    # 11127,
    # 11135,
    # 11252,
    # 11382,
    # 11388,
    # 11389,
    # 11509,
    # 11510,
    # 11511,
    # 11515,
    # 11516,
    # 11517,
    # 11628,
    # 11630,
    # 11637,
    # 11638,
    # 11639,
    # 11756,
    # 11757,
    # 11765,
    # 11769,
    # 11770,
    # 11771,
    # 11775,
    # 11884,
    # 11885,
    # 11892,
    # 11896,
    # 11897,
    # 12012,
    # 12013,
    # 12019,
    # 12020,
    # 12024,
    # 12025,
    # 12144,
    # 12145,
    # 12147,
    # 12148,
    # 12152,
    # 12271,
    # 12272,
    # 12275,
    # 12277,
    # 12278,
    # 12286,
    # 12396,
    # 12397,
    # 12400,
    # 12406,
    # 12407,
    # 12408,
    # 12535,
    # 12536,
    # 12538,
    # 12666,
    # 12667,
    # 12668,
    # 12670,
    # 12789,
    # 12914,
    # 13051,
    # 13171,
    # 13172,
    # 13175,
    # 13177,
    # 13178,
    # 13179,
    # 13296,
    # 13297,
    # 13299,
    # 13300,
    # 13304,
    # 13425,
    # 13426,
    # 13427,
    # 13561,
    # 13686,
    # 13813,
    # 13814,
    # 13815,
    # 13943,
    # 13944,
    # 14060,
    # 14073,
    # 14187,
    # 14188,
    # 14189,
    # 14201,
    # 14202,
    # 14316,
    # 14317,
    # 14323,
    # 14324,
    # 14325,
    # 14329,
    # 14330,
    # 14444,
    # 14445,
    # 14448,
    # 14451,
    # 14452,
    # 14462,
    # 14576,
    # 14577,
    # 14578,
    # 14703,
    # 14704,
    # 14711,
    # 14831,
    # 14832,
    # 14839,
    # 14840,
    # 14843,
    # 14956,
    # 14957,
    # 14958,
    # 14963,
    # 14970,
    # 14971,
    # 14972,
    # 15092,
    # 15221,
    # 15224,
    # 15597,
    # 15598,
    # 15721,
    # 15741,
    # 15849,
    # 15861,
    # 15996,
    # 15997,
    # 16113,
    # 16241,
    # 16245,
    # 16246,
    # 16369,
    # 16373,
    # 16374,
    # 16748,
    # 16749,
    # 16756,
    # 16764,
    # 16766,
    # 16883,
    # 16890,
    # 16891,
    # 16892,
    # 17018,
    # 17264,
    # 17276,
    # 17392,
    # 17399,
    # 17402,
    # 17517,
    # 17522,
    # 17532,
    # 17644,
    # 17645,
    # 17647,
    # 17648,
    # 17649,
    # 17651,
    # 17652,
    # 17776,
    # 17777,
    # 17778,
    # 17780,
    # 17784,
    # 17900,
    # 17901,
    # 17903,
    # 17909,
    # 17912,
    # 18044,
    # 18045,
    # 18165,
    # 18302,
    # 18428,
    # 18430,
    # 18538,
    # 18554,
    # 18556,
    # 18558,
    # 18799,
    # 18940,
    # 19325,
    # 19326,
    # 19453,
    # 19837,
    # 20214,
    # 20215,
    # 20341,
    # 20342,
    # 20476,
    # 20589,
    # 20593,
    # 20595,
    # 20596,
    # 20717,
    # 20718,
    # 20720,
    # 20721,
    # 20724,
    # 20728,
    # 20730,
    # 20731,
    # 20733,
    # 20860,
    # 20861,
    # 20987,
    # 20988,
    # 21359,
    # 21491,
    # 21492,
    # 21495,
    # 21500,
    # 21619,
    # 21620,
    # 21623,
    # 21744,
    # 21872,
    # 21997,
    # 22270,
    # 22387,
    # 22514,
    # 22527,
    # 22654,
    # 22908,
    # 23158,
    # 23159,
    # 23160,
    # 23285,
    # 23286,
    # 23291,
    # 23292,
    # 23294,
    # 23406,
    # 23407,
    # 23408,
    # 23419,
    # 23420,
    # 23421,
    # 23422,
    # 23542,
    # 23543,
    # 23672,
    # 23803,
    # 24308,
    # 24316,
    # 24434,
    # 24562,
    # 24563,
    # 24564,
    # 24574,
    # 24680,
    # 24692,
    # 24699,
    # 24815,
    # 24816,
    # 24821,
    # 24943,
    # 24944,
    # 24949,
    # 24954,
    # 25072,
    # 25332,
    # 25342,
    # 25848,
    # 25853,
    # 25977,
    # 26108,
    # 26357,
    # 26358,
    # 26360,
    # 26362,
    # 26620,
    # 26621,
    # 26743,
    # 26744,
    # 27000,
    # 27255,
    # 27259,
    # 27260,
    # 27383,
    # 27516,
    # 27636,
    # 27762,
    # 27771,
    # 27774,
    # 27891,
    # 27892,
    # 27903,
    # 28021,
    # 28406,
    # 28407,
    # 28412,
    # 28533,
    # 28535,
    # 28539,
    # 28665,
    # 28788,
    # 28794,
    # 28915,
    # 28916,
    # 29043,
    # 29047,
    # 29168,
    # 29171,
    # 29175,
    # 29179,
    # 29298,
    # 29557,
    # 29558,
    # 29561,
    # 29818,
    # 29819,
    # 29942,
    # 30072,
    # 30326,
    # 30332,
    # 30449,
    # 30460,
    # 30582,
    # 30583,
    # 30975,
    # 31094,
    # 31606,
    # 31863,
    # 31867,
    # 31989,
    # 31998,
    # 31999,
    # 32244,
    # 32249,
    # 32371,
    # 32372,
    # 32373,
    # 32379,
    # 32498,
    # 32499,
    # 32500,
    # 32501,
    # 32627,
    # 32632,
    # 32633,
    # 32634,
    # 32755,
    # 33138,
    # 33149,
    # 33274,
    # 33397,
    # 33398,
    # 33402,
    # 33661,
    # 33787,
    # 34173,
    # 34302,
    # 34558,
    # 34677,
    # 34678,
    # 34805,
    # 34806,
    # 35318,
    # 35319,
    # 35325,
    # 35447,
    # 35838,
    # 36089,
    # 36090,
    # 36210,
    # 36212,
    # 36213,
    # 36604,
    # 37111,
    # 37113,
    # 37245,
    # 37624,
    # 38772,
    # 38908,
    # 39030,
    # 39158,
    # 39287,
    # 40176,
    # 40572,
    # 40699,
    # 42109,
    # 42493,
    # 42494,
    # 42740,
    # 42745,
    # 43125,
    # 43126,
    # 43262,
    # 43632,
    # 43758,
    # 43759,
    # 44024,
    # 44158,
    # 44287,
    # 44790,
    # 44796,
    # 44918,
    # 44919,
    # 45806,
    # 46334,
    # 46717,
    # 46846,
    # 47357,
    # 47478,
    # 47486,
    # 48376,
    # 48377,
    # 49141,
    # 49142,
    # 49145,
    # 49146,
    # 49268,
    # 49269,
    # 49270,
    # 49395,
    # 52344,
    # 52349,
    # 52856,
    # 52971,
    # 53749,
    # 53750,
    # 53753,
    # 53875,
    # 54391,
    # 54651,
    # 55156,
    # 55287,
    # 55673,
    # 56441,
    # 56565,
    # 56693,
    # 57080,
    # 57081,
    # 57459,
    # 57588,
    # 57592,
    # 57835,
    # 57970,
    # 58489,
    # 59124,
    # 59892,
    # 60787,
    # 61429,
    # 61430,
    # 61557,
    # 62707,
    # 66549,
    # 66550,
    # 69749,
    # 74997]

# Numerical result
hdf5_file = py.File("../Build/TestsParallel/" + file_name + ".h5", "r")

th_grp = hdf5_file['TimeHistory']['geostatic']
th_num = th_grp.attrs['output_num']

frm_grp = th_grp['frame_20']
pcl_grp = frm_grp['ParticleData']
fld_dset = pcl_grp['field']
fld_mat_ids = fld_dset['mat_id']
mat_grp = frm_grp['MaterialModel']
nor_dset = mat_grp['Norsand']
pcl_num = len(fld_dset)

stress = []
pos = []
void = []
for mat_id in mat_ids:
    mat_dat = nor_dset[mat_id]
    stress.append((mat_dat['s11'], mat_dat['s22'], mat_dat['s33'],
                   mat_dat['s12'], mat_dat['s23'], mat_dat['s31']))
    void.append(mat_dat['e'])
    print(mat_id)
    for pcl_id in range(pcl_num):
        if fld_mat_ids[pcl_id] == mat_id:
            pcl_dat = fld_dset[pcl_id]
            pos.append((pcl_dat['x'], pcl_dat['y'], pcl_dat['z']))
            break

hdf5_file.close()

print("stress:\n")
print(stress)
print(len(stress))

data_file = open("../Build/TestsParallel/" + file_name + "_mat_stress2.csv", "w")
data_file.write("s11, s22, s33, s12, s23, s31, x, y, z, e,\n")
for i in range(len(stress)):
    s_tmp = stress[i]
    p = pos[i]
    data_file.write("%f, %f, %f, %f, %f, %f, %f, %f, %f, %f,\n" %
        (s_tmp[0], s_tmp[1], s_tmp[2], s_tmp[3], s_tmp[4], s_tmp[5],
         p[0], p[1], p[2], void[i]))
data_file.close()
